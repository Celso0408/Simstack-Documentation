

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Incorporating a new WaNo &mdash; Simstack  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tutorial" href="../tutorial/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Simstack
          

          
            
            <img src="../_static/Simstack_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Incorporating a new WaNo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#wano-concept">1. WaNo concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="#morse-potential-example">2. Morse potential example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#starting-a-new-wano-project">2.1 Starting a new <strong>WaNo</strong> project</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tips-and-tricks">3. Tips and tricks</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Simstack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Incorporating a new WaNo</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/incorprating/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="incorporating-a-new-wano">
<h1>Incorporating a new WaNo<a class="headerlink" href="#incorporating-a-new-wano" title="Permalink to this headline">¶</a></h1>
<style> .green {color:green} </style><p>Scientific studies are often obtained by chaining the preparation and execution of multiple interoperable packages
one after the other. The scientific process requires the reproducibility of this simulation chain and the reproducibility
of the singular modules. Here we show how to incorporate a new <strong>WaNo</strong> within in <strong>SimStack</strong> framework, including
its GUI, parameters, and execution process.</p>
<div class="section" id="wano-concept">
<h2>1. WaNo concept<a class="headerlink" href="#wano-concept" title="Permalink to this headline">¶</a></h2>
<p>The Workflow Active Nodes <strong>WaNo</strong> is specified in an <code class="docutils literal notranslate"><span class="pre">XML</span></code> file, which <strong>SimStack</strong> interprets and uses to render
the information of the node from the local machine to the HPC resources. It eases the adjustment of input parameters
and files and is displayed on the right side of the client window, as shown in the last figure of the <strong>Installation</strong>
section. In the code lines below, we highlight in yellow the five possible fields. The absence of the first one will
not raise any execution error, but the remaining are mandatory for any implemented <strong>WaNo</strong>.</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;WaNoTemplate&gt;</span>
<span class="hll">   <span class="nt">&lt;WaNoMeta&gt;</span>
</span>      <span class="nt">&lt;Author&gt;</span>
        <span class="nt">&lt;Name&gt;</span> Celso R. C. Rego <span class="nt">&lt;/Name&gt;</span>
        <span class="nt">&lt;Email&gt;</span>celsorego@kit.edu<span class="nt">&lt;/Email&gt;</span>
      <span class="nt">&lt;/Author&gt;</span>

      <span class="nt">&lt;Description&gt;</span>
        This WaNo performs ...
      <span class="nt">&lt;/Description&gt;</span>

      <span class="nt">&lt;Keyword&gt;</span>Some nice words<span class="nt">&lt;/Keyword&gt;</span>
<span class="hll">   <span class="nt">&lt;/WaNoMeta&gt;</span>
</span>
<span class="hll">   <span class="nt">&lt;WaNoRoot</span> <span class="na">name=</span><span class="s">&quot;TemplateWaNo&quot;</span><span class="nt">&gt;</span>
</span>       Load the input files from a given folder
       Define a set of parameters
<span class="hll">   <span class="nt">&lt;/WaNoRoot&gt;</span>
</span>
<span class="hll">   <span class="nt">&lt;WaNoExecCommand&gt;</span>
</span>       Run the simulation
<span class="hll">   <span class="nt">&lt;/WaNoExecCommand&gt;</span>
</span>
<span class="hll">   <span class="nt">&lt;WaNoInputFiles&gt;</span>
</span>       Name of the mandatory files, e.g., scripts.
<span class="hll">   <span class="nt">&lt;/WaNoInputFiles&gt;</span>
</span>
<span class="hll">   <span class="nt">&lt;WaNoOutputFiles&gt;</span>
</span>       Define the expected output files
<span class="hll">   <span class="nt">&lt;/WaNoOutputFiles&gt;</span>
</span><span class="nt">&lt;/WaNoTemplate&gt;</span>
</pre></div>
</div>
<p>Every element is required to have a name attribute. This name cannot contain “.” characters. Below
we give an overview of the meaning for each element inside the <code class="docutils literal notranslate"><span class="pre">WaNoTemplate</span></code> in the <code class="docutils literal notranslate"><span class="pre">XML</span></code> file above.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">WaNoMeta</span></code> This field is dedicated to the developer information and describes the aims of the <strong>WaNo</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WaNoRoot</span></code> Here is where we define the set of parameters to be exposed and the inputs files of the simulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WaNoExecCommand</span></code> This part is a multiline string, which contains the script or program to execute, when the <strong>WaNo</strong> starts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WaNoInputFiles</span></code> This segment is where we name all static input files, which have to be present in the <strong>WaNo</strong> folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WaNoOutputFiles</span></code> Here is where we name all the expected output files in the output directory. If not
present, your <strong>WaNo</strong> will be shown as aborted (red folder).</p></li>
</ul>
</div>
<div class="section" id="morse-potential-example">
<h2>2. Morse potential example<a class="headerlink" href="#morse-potential-example" title="Permalink to this headline">¶</a></h2>
<p>In this example, we want to include a python program in a new <strong>WaNo</strong>. This script computes the <a class="reference external" href="https://en.wikipedia.org/wiki/Morse_potential">Morse potential</a>
<span class="math notranslate nohighlight">\(V(r)=D_{e}[1-e^{-a(r-r_{e})}]^2-D_{e}\)</span> energy of  a particular diatomic molecule as a function of the intermolecular distance
<span class="math notranslate nohighlight">\((r-r_{e})\)</span> using  <a class="reference external" href="https://numpy.org/">Numpy</a>. Here <span class="green">De</span> is the well depth energy relative to the atoms apart from each
other. <span class="green">a</span> controls the width of the potential, <span class="math notranslate nohighlight">\(\color{green}{r_{e}}\)</span> gives the minimum potential distance. This
scrip loads <code class="docutils literal notranslate"><span class="pre">.yml</span></code> file from where it reads the inputs to compute the Morse potential energy, via the command line, it is executed as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python/intepretor morse.py
</pre></div>
</div>
<div class="section" id="starting-a-new-wano-project">
<h3>2.1 Starting a new <strong>WaNo</strong> project<a class="headerlink" href="#starting-a-new-wano-project" title="Permalink to this headline">¶</a></h3>
<p>To incorporate a new tool, first create a new directory with the <strong>WaNo</strong> name (see the code lines below) in the
<strong>WaNo</strong> repository directory, see Paths configuration in <a class="reference internal" href="../installation/installation.html#configuration"><span class="std std-ref">Simstack Server Configuration</span></a> section. The <strong>WaNo</strong> name should
be unique, in our example, we name it as <em>MORSE-pot</em>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir Morse-Pot
<span class="nb">cd</span> Morse-pot
</pre></div>
</div>
<p>Next, we create a <em>Morse-pot.xml</em> file, and this will specify the Graphical User Interface (GUI) elements in this
<strong>WaNo</strong>. To give our new <strong>WaNo</strong> an icon image, we may add an image <em>MORSE-pot.png</em> directly in the <strong>WaNo</strong> folder. In
such a way, the <strong>SimStack</strong> client will automatically load this image on the node’s area. We think for a while, to what
aspect in this simulation project we want to emphasis; which parameters should be fixed, which are adjustable. For general
purpose, we make all Morse potential parameters flexible.</p>
<p>The python script, here name as <em>morse.py</em>, accepts arguments to specify the Morse potential shape and specify
inter-molecular distance. The outputs are written in the <code class="docutils literal notranslate"><span class="pre">MOROUT.yml</span></code> file. For details, see the code lines below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">yaml</span>

<span class="k">def</span> <span class="nf">Vmorse</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">De</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">re</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the Morse potential, V(r).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">De</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">re</span><span class="p">)))</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">De</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;rendered_wano.yml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">wano_file</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">full_load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="n">decimal_points</span> <span class="o">=</span> <span class="mi">6</span> <span class="c1"># decimal points</span>

    <span class="n">De</span> <span class="o">=</span> <span class="n">wano_file</span><span class="p">[</span><span class="s2">&quot;De (Ry)&quot;</span><span class="p">]</span> <span class="c1">#0.48 #Ry</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="n">wano_file</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="c1">#1.8 </span>
    <span class="n">re</span> <span class="o">=</span> <span class="n">wano_file</span><span class="p">[</span><span class="s2">&quot;re (A)&quot;</span><span class="p">]</span> <span class="c1">#0.8 #Angs</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">wano_file</span><span class="p">[</span><span class="s2">&quot;Mol_distance (A)&quot;</span><span class="p">]</span>  <span class="c1">#0.4 #Angs</span>
    
    <span class="c1"># get morse potential energy</span>
    <span class="n">ymorse</span> <span class="o">=</span> <span class="n">Vmorse</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">De</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">re</span><span class="p">)</span>

    <span class="n">MOROUT</span> <span class="o">=</span> <span class="n">wano_file</span>  <span class="c1"># output file</span>
    
    <span class="n">MOROUT</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ymorse</span><span class="p">,</span><span class="n">decimal_points</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>   
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;MOROUT.yml&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">MOROUT</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span><span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I/O error&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And we give this script the execution access. For a lot of computed problems, we could also have
binaries direct available in our server machine.   We put this Python script inside WaNoInputFile tag.</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;WaNoTemplate&gt;</span>
    
    <span class="nt">&lt;WaNoMeta&gt;</span>
 		<span class="nt">&lt;Author&gt;</span>
  			<span class="nt">&lt;Name&gt;</span> Celso R. C. Rego <span class="nt">&lt;/Name&gt;</span>
  			<span class="nt">&lt;Email&gt;</span>celsorego@kit.edu<span class="nt">&lt;/Email&gt;</span>
 		<span class="nt">&lt;/Author&gt;</span>

		<span class="nt">&lt;Description&gt;</span>
   			This WaNo perform a plot of Morse potential for H2 molecule.
 		<span class="nt">&lt;/Description&gt;</span>

 		<span class="nt">&lt;Keyword&gt;</span>Morse-pot<span class="nt">&lt;/Keyword&gt;</span>
	<span class="nt">&lt;/WaNoMeta&gt;</span>
	
	<span class="nt">&lt;WaNoRoot</span> <span class="na">name=</span><span class="s">&quot;MORSE-pot&quot;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;WaNoFloat</span> <span class="na">name=</span><span class="s">&quot;De (Ry)&quot;</span> <span class="na">description =</span> <span class="s">&quot;The well depth (defined relative to the dissociated atoms)&quot;</span><span class="nt">&gt;</span>0.48<span class="nt">&lt;/WaNoFloat&gt;</span>
	<span class="nt">&lt;WaNoFloat</span> <span class="na">name=</span><span class="s">&quot;a&quot;</span> <span class="na">description =</span> <span class="s">&quot;Controls the width of the potential (the smaller a is, the larger the well)&quot;</span> <span class="nt">&gt;</span>1.8<span class="nt">&lt;/WaNoFloat&gt;</span>
	<span class="nt">&lt;WaNoFloat</span> <span class="na">name=</span><span class="s">&quot;re (A)&quot;</span> <span class="na">description =</span> <span class="s">&quot;The equilibrium bond distance&quot;</span><span class="nt">&gt;</span>0.8<span class="nt">&lt;/WaNoFloat&gt;</span>
	<span class="nt">&lt;WaNoFloat</span> <span class="na">name=</span><span class="s">&quot;Mol_distance (A)&quot;</span> <span class="na">description =</span> <span class="s">&quot;Distance between the atoms&quot;</span> <span class="nt">&gt;</span>1.0<span class="nt">&lt;/WaNoFloat&gt;</span>
	
	<span class="nt">&lt;/WaNoRoot&gt;</span>
	
	<span class="nt">&lt;WaNoExecCommand&gt;</span>
		export NANOVER=V4
		source $NANOMATCH/$NANOVER/configs/simstack_kit.config
		python morse.py
	<span class="nt">&lt;/WaNoExecCommand&gt;</span>
	
	<span class="nt">&lt;WaNoInputFiles&gt;</span>
		<span class="nt">&lt;WaNoInputFile</span> <span class="na">logical_filename=</span><span class="s">&quot;morse.py&quot;</span><span class="nt">&gt;</span>morse.py<span class="nt">&lt;/WaNoInputFile&gt;</span>
	<span class="nt">&lt;/WaNoInputFiles&gt;</span>

	<span class="nt">&lt;WaNoOutputFiles&gt;</span>
		<span class="nt">&lt;WaNoOutputFile&gt;</span>MOROUT.yml<span class="nt">&lt;/WaNoOutputFile&gt;</span>
	<span class="nt">&lt;/WaNoOutputFiles&gt;</span>
<span class="nt">&lt;/WaNoTemplate&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The logical_filename property would map the input file into the given file name when transferred to the server side.</p></li>
<li><p>We need our output of the script within <strong>SimStack</strong> management, so we add</p></li>
<li><p>Regarding to the parameters, we need them adjustable within _SimStack_ client. For instance, we need well depth &lt;font color=”#cc6600”&gt;De&lt;/font&gt; ; we can add inside the _WaNoRoot_ tag</p></li>
<li><p>This means we put an adjustable parameter with its name as &lt;font color=”#cc6600”&gt;De&lt;/font&gt;, units in Rydberg, and its default value is 0.48.  Within WaNo client, a WaNoFloat UI element would accept float data type. With the same spirit, we set up other two parameters. They are  &lt;font color=”#cc6600”&gt;a&lt;/font&gt; with default value 1.8,  &lt;font color=”#cc6600”&gt;r&lt;font size=1&gt;e&lt;/font&gt; &lt;/font&gt; with default value 0.8.</p></li>
<li><p>These three parameters basically set up the shape of the Morse potential. Finally we add the distance where we want to compute the potential inside WaNoRoot.</p></li>
<li><p>Every parameter comes with its description. The WaNo shall be as the following figure. It is ready to use.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/wano_edit.png"><img alt="../_images/wano_edit.png" src="../_images/wano_edit.png" style="width: 800px;" /></a>
</div>
</div>
<div class="section" id="tips-and-tricks">
<h2>3. Tips and tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>If we start a new <strong>WaNo</strong> for the first time, download a <strong>WaNo</strong>, copy this <strong>WaNo</strong> into local <strong>WaNo</strong> repository and modify it. This makes a quick start.</p></li>
<li><p>A lot of scientific packages have a variety of parameters that could, in principle, all be set by the end user. However, for specific, reoccurring user cases, only a specific subset of parameters need be set in one project.</p></li>
<li><p>When we start a new <strong>WaNo</strong>, we need clarify what parameters we need to vary in this specific project, and only include those into WaNo and fix the rest in the scripts.</p></li>
<li><p>Depending on the tool/case, it may be beneficial to provide several separate <strong>WaNos</strong> for one program.Adaptions to the <strong>WaNo</strong> to allow more flexibility is a matter of minutes.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../tutorial/index.html" class="btn btn-neutral float-left" title="Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Celso Ricardo C. Rego.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>